<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buy Credits - Velvet</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(135deg, #1e3a8a 0%, #0f172a 100%); min-height: 100vh; padding: 20px; }
        .header { display: flex; align-items: center; gap: 15px; margin-bottom: 30px; }
        .back-btn { background: white; color: #1e3a8a; border: none; padding: 10px 20px; border-radius: 10px; font-size: 16px; font-weight: 600; cursor: pointer; }
        h1 { color: white; font-size: 28px; }
        .subtitle { color: rgba(255,255,255,0.7); font-size: 14px; margin-top: 5px; }
        .balance-bar { background: rgba(255,255,255,0.1); border-radius: 15px; padding: 20px; margin-bottom: 30px; display: flex; justify-content: space-between; align-items: center; }
        .balance-info { color: white; }
        .balance-info .label { font-size: 14px; opacity: 0.7; }
        .balance-amounts { display: flex; gap: 20px; flex-wrap: wrap; }
        .balance-token { color: white; text-align: center; }
        .balance-token .token-amount { font-size: 22px; font-weight: bold; }
        .balance-token .token-label { font-size: 12px; opacity: 0.7; }
        .tabs { display: flex; gap: 10px; margin-bottom: 25px; overflow-x: auto; padding-bottom: 5px; }
        .tab { background: rgba(255,255,255,0.1); color: white; border: none; padding: 10px 20px; border-radius: 20px; font-size: 14px; font-weight: 600; cursor: pointer; white-space: nowrap; transition: all 0.3s; }
        .tab.active { background: white; color: #1e3a8a; }
        .packages-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        .package-card { background: white; border-radius: 20px; padding: 25px; position: relative; transition: transform 0.3s; }
        .package-card:hover { transform: translateY(-5px); }
        .package-card.popular { border: 3px solid #1e3a8a; }
        .popular-badge { position: absolute; top: -12px; left: 50%; transform: translateX(-50%); background: #1e3a8a; color: white; padding: 4px 16px; border-radius: 20px; font-size: 12px; font-weight: 600; white-space: nowrap; }
        .package-icon { font-size: 40px; margin-bottom: 15px; }
        .package-name { font-size: 20px; font-weight: bold; color: #1e3a8a; margin-bottom: 5px; }
        .package-credits { font-size: 32px; font-weight: bold; color: #333; margin-bottom: 5px; }
        .package-credits span { font-size: 16px; color: #666; font-weight: normal; }
        .package-price { font-size: 24px; font-weight: bold; color: #1e3a8a; margin-bottom: 15px; }
        .package-features { list-style: none; margin-bottom: 20px; }
        .package-features li { padding: 5px 0; color: #666; font-size: 14px; }
        .package-features li::before { content: "âœ“ "; color: #27ae60; font-weight: bold; }
        .buy-btn { width: 100%; padding: 14px; background: #1e3a8a; color: white; border: none; border-radius: 10px; font-size: 16px; font-weight: 600; cursor: pointer; transition: background 0.3s; }
        .buy-btn:hover { background: #15306d; }
        .subscription-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        .sub-card { background: white; border-radius: 20px; padding: 25px; text-align: center; }
        .sub-card.gold { border: 3px solid #FFD700; }
        .sub-card.platinum { border: 3px solid #9B59B6; }
        .sub-name { font-size: 24px; font-weight: bold; margin-bottom: 10px; }
        .sub-price { font-size: 36px; font-weight: bold; color: #1e3a8a; margin-bottom: 5px; }
        .sub-price span { font-size: 16px; color: #666; font-weight: normal; }
        .sub-features { list-style: none; margin: 15px 0; text-align: left; }
        .sub-features li { padding: 6px 0; color: #555; font-size: 14px; border-bottom: 1px solid #f0f0f0; }
        .sub-features li::before { content: "âœ“ "; color: #27ae60; font-weight: bold; }
        .hidden { display: none; }
        .secure-badge { text-align: center; color: rgba(255,255,255,0.6); font-size: 13px; margin-top: 20px; }
        .token-guide { background: rgba(255,255,255,0.1); border-radius: 15px; padding: 15px 20px; margin-bottom: 25px; display: flex; gap: 20px; flex-wrap: wrap; }
        .token-item { color: white; font-size: 14px; display: flex; align-items: center; gap: 8px; }
        .token-item span { opacity: 0.8; }
    </style>
</head>
<body>
    <div class="header">
        <button class="back-btn" onclick="window.location.href='velvet-chat.html'">â† Back</button>
        <div>
            <h1>Buy Credits</h1>
            <div class="subtitle">Powered by Cold Brew Coffee Co â€¢ Secure payments â€¢ (Cold Brew Coffee will appear on your Bank - enjoy your coffee ğŸ˜‰)</div>
        </div>
    </div>

    <div class="balance-bar">
        <div class="balance-info">
            <div class="label">Your Balance</div>
            <div class="balance-amounts" id="userBalance">
                <div class="balance-token"><div class="token-amount" id="bal-choc">0</div><div class="token-label">ğŸ« Chocolates</div></div>
                <div class="balance-token"><div class="token-amount" id="bal-rose">0</div><div class="token-label">ğŸŒ¹ Roses</div></div>
                <div class="balance-token"><div class="token-amount" id="bal-champ">0</div><div class="token-label">ğŸ¥‚ Champagne</div></div>
                <div class="balance-token"><div class="token-amount" id="bal-heart">0</div><div class="token-label">â¤ï¸ Hearts</div></div>
            </div>
        </div>
        <div style="color:rgba(255,255,255,0.7);font-size:13px;text-align:right;">Credits never expire<br>while account is active<br>Non Transferrable</div>
    </div>

    <div class="token-guide">
        <div class="token-item">ğŸ« <span>Chocolate = 1 message (25p)</span></div>
        <div class="token-item">ğŸŒ¹ <span>Rose = 1 photo (Â£1.50)</span></div>
        <div class="token-item">ğŸ¥‚ <span>Champagne = 1 voice note (Â£2.00)</span></div>
        <div class="token-item">â¤ï¸ <span>Heart = 1 video (Â£5.00)</span></div>
    </div>

    <div class="tabs">
        <button class="tab active" onclick="showTab('messages', this)">ğŸ« Messages</button>
        <button class="tab" onclick="showTab('photos', this)">ğŸŒ¹ Photos</button>
        <button class="tab" onclick="showTab('voice', this)">ğŸ¥‚ Voice</button>
        <button class="tab" onclick="showTab('videos', this)">â¤ï¸ Videos</button>
        <button class="tab" onclick="showTab('subscriptions', this)">â­ Subscriptions</button>
    </div>

    <!-- Messages -->
    <div id="tab-messages" class="packages-grid">
        <div class="package-card">
            <div class="package-icon">ğŸ«</div>
            <div class="package-name">Starter</div>
            <div class="package-credits">60 <span>Chocolates</span></div>
            <div class="package-price">Â£15.00</div>
            <ul class="package-features">
                <li>60 messages</li>
                <li>25p per message</li>
                <li>Never expires</li>
            </ul>
            <button class="buy-btn" onclick="purchase('messages_60', 1500, '60 Chocolates - 60 Messages')">Buy Now</button>
        </div>
        <div class="package-card popular">
            <div class="popular-badge">â­ Most Popular</div>
            <div class="package-icon">ğŸ«</div>
            <div class="package-name">Popular</div>
            <div class="package-credits">80 <span>Chocolates</span></div>
            <div class="package-price">Â£20.00</div>
            <ul class="package-features">
                <li>80 messages</li>
                <li>25p per message</li>
                <li>Never expires</li>
            </ul>
            <button class="buy-btn" onclick="purchase('messages_80', 2000, '80 Chocolates - 80 Messages')">Buy Now</button>
        </div>
        <div class="package-card">
            <div class="package-icon">ğŸ«</div>
            <div class="package-name">Value</div>
            <div class="package-credits">100 <span>Chocolates</span></div>
            <div class="package-price">Â£25.00</div>
            <ul class="package-features">
                <li>100 messages</li>
                <li>25p per message</li>
                <li>Never expires</li>
            </ul>
            <button class="buy-btn" onclick="purchase('messages_100', 2500, '100 Chocolates - 100 Messages')">Buy Now</button>
        </div>
    </div>

    <!-- Photos -->
    <div id="tab-photos" class="packages-grid hidden">
        <div class="package-card">
            <div class="package-icon">ğŸŒ¹</div>
            <div class="package-name">Starter</div>
            <div class="package-credits">6 <span>Roses</span></div>
            <div class="package-price">Â£10.00</div>
            <ul class="package-features">
                <li>6 photo unlocks</li>
                <li>Â£1.50 per photo</li>
                <li>Never expires</li>
            </ul>
            <button class="buy-btn" onclick="purchase('photos_6', 1000, '6 Roses - 6 Photo Unlocks')">Buy Now</button>
        </div>
        <div class="package-card popular">
            <div class="popular-badge">â­ Most Popular</div>
            <div class="package-icon">ğŸŒ¹</div>
            <div class="package-name">Popular</div>
            <div class="package-credits">10 <span>Roses</span></div>
            <div class="package-price">Â£15.00</div>
            <ul class="package-features">
                <li>10 photo unlocks</li>
                <li>Â£1.50 per photo</li>
                <li>Never expires</li>
            </ul>
            <button class="buy-btn" onclick="purchase('photos_10', 1500, '10 Roses - 10 Photo Unlocks')">Buy Now</button>
        </div>
        <div class="package-card">
            <div class="package-icon">ğŸŒ¹</div>
            <div class="package-name">Value</div>
            <div class="package-credits">14 <span>Roses</span></div>
            <div class="package-price">Â£20.00</div>
            <ul class="package-features">
                <li>14 photo unlocks</li>
                <li>Â£1.43 per photo</li>
                <li>Never expires</li>
            </ul>
            <button class="buy-btn" onclick="purchase('photos_14', 2000, '14 Roses - 14 Photo Unlocks')">Buy Now</button>
        </div>
    </div>

    <!-- Voice -->
    <div id="tab-voice" class="packages-grid hidden">
        <div class="package-card">
            <div class="package-icon">ğŸ¥‚</div>
            <div class="package-name">Starter</div>
            <div class="package-credits">10 <span>Champagnes</span></div>
            <div class="package-price">Â£20.00</div>
            <ul class="package-features">
                <li>10 voice note unlocks</li>
                <li>Â£2.00 per voice note</li>
                <li>Never expires</li>
            </ul>
            <button class="buy-btn" onclick="purchase('voice_10', 2000, '10 Champagnes - 10 Voice Notes')">Buy Now</button>
        </div>
        <div class="package-card popular">
            <div class="popular-badge">â­ Most Popular</div>
            <div class="package-icon">ğŸ¥‚</div>
            <div class="package-name">Popular</div>
            <div class="package-credits">14 <span>Champagnes</span></div>
            <div class="package-price">Â£25.00</div>
            <ul class="package-features">
                <li>14 voice note unlocks</li>
                <li>Â£1.79 per voice note</li>
                <li>Never expires</li>
            </ul>
            <button class="buy-btn" onclick="purchase('voice_14', 2500, '14 Champagnes - 14 Voice Notes')">Buy Now</button>
        </div>
        <div class="package-card">
            <div class="package-icon">ğŸ¥‚</div>
            <div class="package-name">Value</div>
            <div class="package-credits">30 <span>Champagnes</span></div>
            <div class="package-price">Â£50.00</div>
            <ul class="package-features">
                <li>30 voice note unlocks</li>
                <li>Â£1.67 per voice note</li>
                <li>Never expires</li>
            </ul>
            <button class="buy-btn" onclick="purchase('voice_30', 5000, '30 Champagnes - 30 Voice Notes')">Buy Now</button>
        </div>
    </div>

    <!-- Videos -->
    <div id="tab-videos" class="packages-grid hidden">
        <div class="package-card">
            <div class="package-icon">â¤ï¸</div>
            <div class="package-name">Starter</div>
            <div class="package-credits">5 <span>Hearts</span></div>
            <div class="package-price">Â£25.00</div>
            <ul class="package-features">
                <li>5 video unlocks</li>
                <li>Â£5.00 per video</li>
                <li>Never expires</li>
            </ul>
            <button class="buy-btn" onclick="purchase('videos_5', 2500, '5 Hearts - 5 Video Unlocks')">Buy Now</button>
        </div>
        <div class="package-card popular">
            <div class="popular-badge">â­ Most Popular</div>
            <div class="package-icon">â¤ï¸</div>
            <div class="package-name">Popular</div>
            <div class="package-credits">12 <span>Hearts</span></div>
            <div class="package-price">Â£50.00</div>
            <ul class="package-features">
                <li>12 video unlocks</li>
                <li>Â£4.17 per video</li>
                <li>Never expires</li>
            </ul>
            <button class="buy-btn" onclick="purchase('videos_12', 5000, '12 Hearts - 12 Video Unlocks')">Buy Now</button>
        </div>
        <div class="package-card">
            <div class="package-icon">â¤ï¸</div>
            <div class="package-name">Value</div>
            <div class="package-credits">20 <span>Hearts</span></div>
            <div class="package-price">Â£75.00</div>
            <ul class="package-features">
                <li>20 video unlocks</li>
                <li>Â£3.75 per video</li>
                <li>Never expires</li>
            </ul>
            <button class="buy-btn" onclick="purchase('videos_20', 7500, '20 Hearts - 20 Video Unlocks')">Buy Now</button>
        </div>
    </div>

    <!-- Subscriptions -->
    <div id="tab-subscriptions" class="subscription-grid hidden">
        <div class="sub-card">
            <div class="sub-name">ğŸ¥ˆ Silver</div>
            <div class="sub-price">Â£29.99 <span>/month</span></div>
            <ul class="sub-features">
                <li>100 ğŸ« Chocolates</li>
                <li>5 ğŸŒ¹ Roses</li>
                <li>Priority response</li>
                <li>Cancel anytime</li>
            </ul>
            <button class="buy-btn" onclick="purchase('sub_silver', 2999, 'Silver Subscription')">Subscribe</button>
        </div>
        <div class="sub-card gold">
            <div class="sub-name">ğŸ¥‡ Gold</div>
            <div class="sub-price">Â£59.99 <span>/month</span></div>
            <ul class="sub-features">
                <li>200 ğŸ« Chocolates</li>
                <li>10 ğŸŒ¹ Roses</li>
                <li>5 ğŸ¥‚ Champagnes</li>
                <li>Priority response</li>
                <li>Cancel anytime</li>
            </ul>
            <button class="buy-btn" onclick="purchase('sub_gold', 5999, 'Gold Subscription')">Subscribe</button>
        </div>
        <div class="sub-card platinum">
            <div class="sub-name">ğŸ’ Platinum</div>
            <div class="sub-price">Â£99.99 <span>/month</span></div>
            <ul class="sub-features">
                <li>Unlimited ğŸ« Chocolates</li>
                <li>20 ğŸŒ¹ Roses</li>
                <li>10 ğŸ¥‚ Champagnes</li>
                <li>3 â¤ï¸ Hearts</li>
                <li>VIP priority response</li>
                <li>Cancel anytime</li>
            </ul>
            <button class="buy-btn" onclick="purchase('sub_platinum', 9999, 'Platinum Subscription')">Subscribe</button>
        </div>
    </div>

    <div class="secure-badge">ğŸ”’ Payments processed securely by Stripe â€¢ Cold Brew Coffee Co</div>

    <script src="https://js.stripe.com/v3/"></script>
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, doc, getDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyArbpb25d8UwEL5bE46Oe8yAMTMM1BoGzU",
            authDomain: "velvet-app-1733e.firebaseapp.com",
            projectId: "velvet-app-1733e",
            storageBucket: "velvet-app-1733e.firebasestorage.app",
            messagingSenderId: "514672347699",
            appId: "1:514672347699:web:a70516f6383e0069a7f146"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        const stripe = Stripe('pk_test_51T1UwBFEbPdPCMYiP6vlpOx2Vm8M8LaOLnMIzxqsHflKFnPVydRaxuMnn1URSK44l79CQdjgDvN8mYuqohBWhmlH00xYfD5NA8');

        onAuthStateChanged(auth, async (user) => {
            if (!user) {
                window.location.href = 'auth.html';
                return;
            }
            try {
                const creatorCode = sessionStorage.getItem('currentCreatorCode');
                const userDoc = await getDoc(doc(db, 'users', user.uid));
                if (userDoc.exists() && creatorCode) {
                    const credits = userDoc.data().credits?.[creatorCode] || {};
                    document.getElementById('bal-choc').textContent = credits.chocolates || 0;
                    document.getElementById('bal-rose').textContent = credits.roses || 0;
                    document.getElementById('bal-champ').textContent = credits.champagne || 0;
                    document.getElementById('bal-heart').textContent = credits.hearts || 0;
                }
            } catch(e) {
                console.error('Balance error:', e);
            }
        });

        window.showTab = function(tab, el) {
            document.querySelectorAll('.packages-grid, .subscription-grid').forEach(e => e.classList.add('hidden'));
            document.querySelectorAll('.tab').forEach(e => e.classList.remove('active'));
            document.getElementById('tab-' + tab).classList.remove('hidden');
            el.classList.add('active');
        }

        window.purchase = async function(packageId, amountPence, packageName) {
            const user = auth.currentUser;
            if (!user) {
                alert('Please log in first');
                window.location.href = 'auth.html';
                return;
            }

            try {
                const creatorCode = sessionStorage.getItem('currentCreatorCode') || '';
                const response = await fetch('https://velvet-backend-zeta.vercel.app/api/stripe-checkout', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        packageId,
                        amountPence,
                        packageName,
                        userId: user.uid,
                        creatorCode
                    })
                });

                const data = await response.json();

                if (data.url) {
                    window.location.href = data.url;
                } else {
                    alert('Error: ' + data.error);
                }
            } catch (error) {
                alert('Payment error: ' + error.message);
            }
        }
    </script>
</body>
</html>